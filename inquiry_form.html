<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>询价单</title>
    
    <!-- 引入 XLSX.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <!-- 引入 DataTables 样式 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.6.2/css/colReorder.dataTables.min.css">

    <!-- 引入 Bootstrap 样式 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* 页面背景和通用字体设置 */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #6b9dfc, #84c0fb);
            color: #333;
            margin: 0;
            padding: 0;
        }

        /* 主容器样式 */
        .container {
            max-width: 90%;
            margin: 50px auto;
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
            text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
        }

        /* 表格样式 */
        table.dataTable {
            border-collapse: collapse;
            width: 100%;
        }

        table.dataTable th, table.dataTable td {
            text-align: center;
            padding: 15px;
            border: 1px solid #ddd;
            height: 50px; /* 固定单元格高度 */
            vertical-align: middle;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        table.dataTable th {
            background: #f7f7f7;
            font-weight: bold;
            color: #555;
        }

        table.dataTable tbody tr:hover {
            background-color: #f1f1f1;
        }

        .dataTables_wrapper .dataTables_filter input {
            border-radius: 20px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            width: 250px;
            font-size: 14px;
        }

        .table-container {
            max-height: 500px;
            overflow-y: auto;
        }

        /* 按钮样式 */
        .btn {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 30px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4caf50;
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: #45a049;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: #ddd;
            color: #333;
            border: none;
        }

        .btn-secondary:hover {
            background: #ccc;
            color: #111;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        /* 筛选框样式 */
        .column-filter {
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px;
            font-size: 14px;
            box-sizing: border-box;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>询价单</h1>
        <div class="table-container">
            <table id="data-table" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="select-all"></th> <!-- 全选复选框 -->
                        
                        <th>序号</th>
                        
                        <th>物料编码</th>
                        
                        <th>产品名称</th>
                        
                        <th>品牌或生产厂家</th>
                        
                        <th>单位</th>
                        
                        <th>需求数量</th>
                        
                        <th>需求备注</th>
                        
                        <th>项目公司</th>
                        
                        <th>联系电话</th>
                        
                        <th>联系人</th>
                        
                        <th>创建日期</th>
                        
                        <th>送货地址</th>
                        
                        <th>交期（天）</th>
                        
                        <th>单价（元）</th>
                        
                        <th>金额（元）</th>
                        
                        <th>报价备注</th>
                        
                    </tr>
                    <tr>
                        <th></th> <!-- 预留复选框列 -->
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 序号"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 物料编码"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 产品名称"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 品牌或生产厂家"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 单位"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 需求数量"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 需求备注"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 项目公司"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 联系电话"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 联系人"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 创建日期"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 送货地址"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 交期（天）"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 单价（元）"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 金额（元）"></th>
                        
                        <th><input type="text" class="column-filter" placeholder="筛选 报价备注"></th>
                        
                    </tr>
                </thead>
                <tbody>
                    
                    <tr>
                        <td><input type="checkbox" class="row-checkbox"></td> <!-- 每行复选框 -->
                        
                        <td title="20241224001">20241224001</td>
                        
                        <td title="1000496217">1000496217</td>
                        
                        <td title="氮化硼绝缘纸/830*630
">氮化硼绝缘纸/830*630
</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                        <td title="nan">nan</td>
                        
                    </tr>
                    
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-center">
            <a href="index.html" class="btn btn-secondary">返回入口页面</a>
        </div>
    </div>

    <!-- 引入 jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- 引入 DataTables 核心库 -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <!-- 引入 JSZip（支持 Excel 导出） -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- 引入 DataTables Buttons 插件 -->
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>

    <!-- 引入 DataTables ColReorder 插件 -->
    <script src="https://cdn.datatables.net/colreorder/1.6.2/js/dataTables.colReorder.min.js"></script>

    <script>

	var excelTemplateUrl = "https://raw.githubusercontent.com/linucas3355/linucas3355.github.io/static/templates/Inquiry_template.xlsx";

        $(document).ready(function () {
            // 初始化 DataTables
            let table = $('#data-table').DataTable({
                dom: '<"d-flex justify-content-between"Bf>tip',  // 布局调整：按钮和搜索框在一行
		columnDefs: [
			{
				targets: [2], 
				render: function (data, type, row) {
					return data ? data.toString().replace(/\.0+$/,'')  :  '';
				}
			}
		],
                buttons: [
                    {
                        extend: 'excelHtml5', // 使用 DataTables 内置的 Excel 导出功能
                        text: '导出选中行 (Excel)',
                        className: 'btn btn-primary',
                        filename: '询价单_选中行数据',
                        exportOptions: {
                            columns: ':visible', // 只导出可见列
                            rows: function (idx, data, node) {
                                return $('.row-checkbox').eq(idx).prop('checked'); // 仅导出选中行
                            }
                        },		
			
		// Excel 导出时应用自定义模板
                customize: function (xlsx) {
                    // 如果是 "询价单" 页面，则使用自定义 Excel 模板
                    if (window.location.pathname.includes("inquiry_form.html")) {
                        // 通过 Ajax 请求获取模板
                        $.ajax({
                            url: excelTemplateUrl,  // 你的模板 URL
                            method: 'GET',
                            success: function (data) {
                                var wb = XLSX.read(data, { type: 'binary' });

                                // 获取模板中的第一个工作表
                                var sheet = wb.Sheets[wb.SheetNames[0]];

                                // 获取模板中的前五行（假设这些行是固定的，不变）
                                var fixedRows = XLSX.utils.sheet_to_json(sheet, { header: 1 }).slice(0, 5);

                                // 获取从第六行开始的数据
                                var rowData = table.rows({ selected: true }).data().toArray();  // 获取选中的数据

                                // 将模板前五行与数据合并
                                var mergedData = fixedRows.concat(rowData);

                                // 创建新的工作表（合并前五行和数据）
                                var newSheet = XLSX.utils.aoa_to_sheet(mergedData);

                                // 将新数据合并进模板
                                wb.Sheets[wb.SheetNames[0]] = newSheet;
                                var newExcelData = XLSX.write(wb, { bookType: 'xlsx', type: 'base64' });

                                // 将修改后的数据进行导出
                                var link = document.createElement('a');
                                link.href = 'data:application/octet-stream;base64,' + newExcelData;
                                link.download = '询价单_导出模板.xlsx';
                                link.click();
                            },
                            error: function (err) {
                                console.log('获取模板失败', err);
                            }
                        });
                    }
                }

                    },
                    {
                        extend: 'excelHtml5', // 使用 DataTables 内置的 Excel 导出功能
                        text: '导出全部数据 (Excel)',
                        className: 'btn btn-success',
                        filename: '询价单_全部数据',
                        exportOptions: {
                            columns: ':visible' // 导出所有可见列
                        }
                    }
                ],
                colReorder: true,  // 启用列宽拖动功能
                paging: true,      // 启用分页
                searching: true,   // 启用搜索
                info: true,        // 显示表格信息
                ordering: false,   // 禁用默认排序
                language: {        // 本地化文本
                    search: "搜索：",
                    lengthMenu: "每页显示 _MENU_ 条记录",
                    info: "显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                    infoEmpty: "没有数据",
                    paginate: {
                        first: "首页",
                        last: "末页",
                        next: "下一页",
                        previous: "上一页"
                    }
                }
            });

            // 全选复选框功能
            $('#select-all').on('click', function () {
                const isChecked = $(this).prop('checked');
                $('.row-checkbox').prop('checked', isChecked);
            });

            // 添加筛选功能
            $('#data-table thead tr:eq(1) th').each(function (i) {
                $('input', this).on('keyup change', function () {
                    if (table.column(i).search() !== this.value) {
                        table.column(i).search(this.value).draw();
                    }
                });
            });
        });
    </script>
</body>
</html>